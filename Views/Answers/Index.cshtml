@model IEnumerable<FlightTickets.Models.Answer>

@{
    ViewData["Title"] = "Index";
}
@{
    var processedQuestionIds = new HashSet<int>();
}

<h1>Frequently Asked Questions</h1>

@if (User.Identity.IsAuthenticated && User.IsInRole("User"))
{
    <p>
        <a asp-area="" asp-controller="Questions" asp-action="Create">Add question</a>
    </p>
}

@foreach (var item in Model)
{
    @if (processedQuestionIds.Contains(item.QuestionId)) continue;
    <tr>
        <td>
            @if (!processedQuestionIds.Contains(item.QuestionId))
            {
                <div class="card">
                    <p class="card-header">@Html.DisplayFor(modelItem => item.Question.AppUser) </p>
                    <p class="card-body">@Html.DisplayFor(modelItem => item.Question.Comment)
                        @if (User.Identity.IsAuthenticated && User.IsInRole("Admin"))
                        {
                            <a asp-action="Create" asp-route-id="@item.Id">Add Answer</a>
                            <a asp-area="" asp-controller="Questions" asp-action="Delete" asp-route-id="@item.QuestionId">Delete this comment</a>
                        }
                    </p>
                </div>
                processedQuestionIds.Add(item.QuestionId);
            }
        </td>
        <th>
            @if (item.Question.Answers != null)
            {
                foreach (var answer in item.Question.Answers)
                {
                    <div class="card">
                        <p class="card-header">@answer.AppUser</p>
                        <p class="card-body">@answer.Comment
                            @if (User.Identity.IsAuthenticated && User.IsInRole("Admin"))
                            {
                                <a asp-action="Delete" asp-route-id="@answer.Id">Delete</a>
                            }
                        </p>
                    </div>
                }
            }
            else
            {
                <li>No ticket information available</li>
            }
        </th>
    </tr>
    <br>
    <br>
}
